<!-- Buttons zur Navigation zwischen Wochen -->
<div class="btn-group">
  <button id="prev-week">&#8592; Vorherige Woche</button>
  <span id="week-label" style="align-self: center; font-weight: bold; color: #004d40;">Diese Woche</span>
  <button id="next-week">Nächste Woche &#8594;</button>
</div>
<canvas id="chart"></canvas>

<script>
let currentWeekOffset = 0; // 0 = aktuelle Woche

function getWeekDates(offset = 0) {
  const today = new Date();
  const monday = new Date(today);
  const currentDay = today.getDay();
  const distanceToMonday = (currentDay + 6) % 7; // 0 = Montag
  monday.setDate(today.getDate() - distanceToMonday + offset * 7);
  const days = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(monday);
    d.setDate(monday.getDate() + i);
    days.push(d);
  }
  return days;
}

function formatDateShort(d) {
  return d.toLocaleDateString('de-CH', { weekday: 'short', day: 'numeric', month: 'numeric' });
}

function updateChartForWeek(offset = 0) {
  const weekDates = getWeekDates(offset);
  const labels = weekDates.map(formatDateShort);
  const data = weekDates.map(d => {
    const key = d.toLocaleDateString('de-CH');
    return sumForKey(key);
  });
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'ml pro Tag',
        data,
        backgroundColor: '#00bcd4'
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } },
      responsive: true,
      plugins: { legend: { display: false } }
    }
  });
  const weekStart = weekDates[0];
  const weekEnd = weekDates[6];
  document.getElementById('week-label').textContent =
    `KW ${getISOWeekNumber(weekStart)} (${weekStart.toLocaleDateString('de-CH')} – ${weekEnd.toLocaleDateString('de-CH')})`;
}

function getISOWeekNumber(d) {
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
  return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
}

// Event Listener für Woche wechseln

updateChartForWeek(currentWeekOffset);

document.getElementById('prev-week').addEventListener('click', () => {
  currentWeekOffset--;
  updateChartForWeek(currentWeekOffset);
});

document.getElementById('next-week').addEventListener('click', () => {
  currentWeekOffset++;
  updateChartForWeek(currentWeekOffset);
});

// Initialisierung
updateUI = function () {
  renderGlasses();
  const vols = loadVols();
  const cnt = vols.length;
  const sum = vols.reduce((a, b) => a + b, 0);
  document.getElementById('daily-summary').textContent =
    `Heute: ${cnt} Gläser, ${formatVolume(sum)}`;
  updateChartForWeek(currentWeekOffset);
};
</script>
